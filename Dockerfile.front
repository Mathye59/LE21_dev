FROM node:20-alpine

WORKDIR /app

# Copie package.json et package-lock.json
COPY package*.json ./

# Installation avec logs verbeux
RUN echo "üì¶ Installation des d√©pendances..." && \
    npm cache clean --force && \
    npm install --legacy-peer-deps --verbose && \
    echo "‚úÖ Installation termin√©e" && \
    echo "üîç V√©rification react-router-dom..." && \
    npm list react-router-dom || echo "‚ö†Ô∏è  react-router-dom non trouv√©!"

# Copie le code source
COPY . .

EXPOSE 5173

# Commande avec fallback d'installation
CMD ["sh", "-c", "echo 'üîç V√©rif modules...' && ls node_modules/react-router-dom && npm run dev -- --host --port 5173 || (echo '‚ö†Ô∏è R√©installation...' && npm install --legacy-peer-deps && npm run dev -- --host --port 5173)"]